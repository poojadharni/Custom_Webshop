{% extends "templates/web.html" %}

{% block page_content %}

<!-- Google Fonts -->
<link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Inter:wght@300;400;500&display=swap"
    rel="stylesheet" />

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

<!-- Custom CSS -->
<link rel="stylesheet" href="/assets/new_webshow/css/home.css">


<!-- HERO CONTENT -->
<div class="hero">
    <h1 class="reveal delay-1">Q-Dynamics</h1>
    <p class="reveal delay-2">Artisanal Touches for Your Living Space</p>
    <a href="/all-products" class="shop-now reveal delay-3">SHOP NOW ↗</a>
</div>

<!-- HERO IMAGE -->
<div class="hero-image reveal-scale delay-2">
    <img src="/assets/new_webshow/images/image1.png" alt="Living Space">
</div>

<!-- LANDING SECTION -->
<section class="landing-wrapper">

    <div class="landing-content">
        <span class="collection-label reveal delay-1">New Collection</span>

        <h1 class="main-heading reveal delay-2">
            BRING A TOUCH OF<br>
            NATURE INDOORS
        </h1>

        <a href="/all-products" class="reveal delay-3">SHOP NOW ↗</a>

        <div class="preview-box reveal-scale delay-4">
            <img src="/assets/new_webshow/images/stool.png" alt="Product Preview">
        </div>
    </div>

    <div class="landing-visual reveal-right delay-2">
        <img src="/assets/new_webshow/images/lamp.png" alt="Hero Image">
    </div>

</section>

<!-- STORY SECTION -->
<section class="story-section">

    <div class="story-top">
        <div class="story-nav reveal delay-1">
            <span>ABOUT<br>CRAFTICO</span>
            <span>TIMLESS<br>ARTISTRY</span>
        </div>

        <h1 class="story-quote reveal delay-2">
            “THE BEAUTY IN IMPERFECTIONS<br>
            REVEALS THE STORY OF ARTISTRY AND<br>
            CRAFTMANSHIP.”
        </h1>
    </div>

    <div class="story-grid">
        <div class="story-empty"></div>

        <div class="story-content reveal delay-3">
            <p>
                This is a space to share more about the business: who’s behind it,
                what it does and what this site has to offer.
            </p>

            <a href="#" class="story-link">READ MORE ↗</a>
        </div>
    </div>
</section>

<!-- BEST SELLERS -->
<section class="best-sellers">
    <h2 class="best-title reveal delay-1">BEST SELLERS</h2>

    <div class="product-grid" id="product-grid">
        <!-- Products dynamically loaded -->
    </div>
</section>


<script>
    // Helper functions for Frappe e-commerce
    function addToCart(productRoute, qty = 1, button) {
        if (!frappe.session.user || frappe.session.user === 'Guest') {
            alert('Please login to add to cart');
            window.location.href = '/login';
            return;
        }

        fetch('/api/method/frappe.e_commerce.add_to_cart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Frappe-CSRF-Token': frappe.csrf_token
            },
            body: JSON.stringify({ item_code: productRoute, qty })
        })
            .then(res => res.json())
            .then(data => {
                if (data.message) {
                    // Visually indicate added to cart
                    button.classList.add('added-to-cart');
                    frappe.call('frappe.e_commerce.cart.update_cart_count'); // Update cart count
                } else {
                    console.log('Failed to add to cart', data);
                }
            })
            .catch(err => console.error(err));
    }

    function addToWishlist(productRoute, button) {
        if (!frappe.session.user || frappe.session.user === 'Guest') {
            alert('Please login to add to wishlist');
            window.location.href = '/login';
            return;
        }

        fetch('/api/method/frappe.e_commerce.add_to_wishlist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Frappe-CSRF-Token': frappe.csrf_token
            },
            body: JSON.stringify({ item_code: productRoute })
        })
            .then(res => res.json())
            .then(data => {
                if (data.message) {
                    // Visually indicate wishlisted
                    button.classList.add('wishlisted');
                } else {
                    console.log('Failed to add to wishlist', data);
                }
            })
            .catch(err => console.error(err));
    }

    // Helper to create a route/slug if API doesn't provide it
    function generateSlug(name) {
        return name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9\-]/g, '');
    }

    // Fetch products from API
    fetch('/api/method/new_webshow.api.items.get_all_items')
        .then(res => res.json())
        .then(data => {
            const products = data.message;
            const productGrid = document.getElementById('product-grid');

            products.forEach((product, index) => {
                const productRoute = product.route || generateSlug(product.item_name);

                const productCard = document.createElement('div');
                productCard.className = `product-card reveal-scale delay-${index + 1}`;
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.item_name}" class="product-image"
                        onclick="window.location.href='/${productRoute}'">
                    <div class="product-info">
                        <p class="product-name">${product.item_name}</p>
                        <p class="product-price">₹${product.standard_rate}</p>
                    </div>
                    <div class="icon-container">
                        <button title="Add to Wishlist" onclick="addToWishlist('${productRoute}', this)">
                            <svg class="wishlist-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4.318 6.318a4.5 4.5 0 010 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                            </svg>
                        </button>
                        <button title="Add to Cart" onclick="addToCart('${productRoute}',1,this)">
                            <svg class="cart-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-1.6 8H19m-12-8l-1-5h13.2"/>
                            </svg>
                        </button>
                    </div>
                `;
                productGrid.appendChild(productCard);
            });

            // Scroll reveal animations
            const items = document.querySelectorAll('.reveal, .reveal-left, .reveal-right, .reveal-scale');
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('show');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.15 });
            items.forEach(el => observer.observe(el));
        })
        .catch(err => console.error('Error fetching products:', err));
</script>

<style>
    /* Wishlist icon red when clicked */
    .wishlisted svg {
        fill: red;
        stroke: red;
        transition: 0.3s;
    }

    /* Cart icon visual change when clicked */
    .added-to-cart svg {
        opacity: 0.5;
        filter: blur(1px);
        transition: 0.3s;
    }
</style>




{% endblock %}